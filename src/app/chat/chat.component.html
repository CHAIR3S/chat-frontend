
<div class="flex min-h-screen w-full">
    <div class="hidden border-r bg-muted/40 lg:block">
      <div class="flex h-full max-h-screen flex-col gap-2">
        <div class="flex h-[60px] items-center border-b px-6 sm: w-[300px]">
          <a routerLink="#" class="flex items-center gap-2 font-semibold" prefetch={false}>
            <!-- <MessageSquareIcon class="h-6 w-6" /> -->
  
            <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
          </svg>
  
  
            <span class="">Chat App</span>
          </a>
          <Button variant="outline" size="icon" class="ml-auto h-8 w-8" (click)="subscribeSocket()">
            <!-- <SearchIcon class="h-4 w-4" /> -->
            <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.3-4.3" />
          </svg>
            <span class="sr-only">Search</span>
          </Button>
        </div>

        
        <!-- <div class="bg-gray-100"> -->
          <!-- <div class="max-w-sm mx-auto my-10"> -->
              <div class="bg-white  rounded-lg overflow-hidden">
                  <ul class="divide-y divide-gray-200">
                      
                    @if(chatService.chats.length != 0){

                      @for (chat of chatService.chats; track chat.idChat) {
                        
                        <app-chat-card 
                        [nombre]="(idUser == chat.viaje.conductor.idUsuario) ? chat.viaje.cliente.nombre : chat.viaje.conductor.nombre" 
                        [mensaje]="obtenerUltimoMensaje(chat.idChat)" [idChat]="chat.idChat"
                        (change)="changeChat($event)"
                        />
  
                      }
                    } @else {
                      <div class="flex items-center justify-center">
                        No hay chats por mostrar
                      </div>
                    }


                      <!-- <li class="p-3 flex justify-between items-center user-card">
                          <div class="flex items-center">
                              <img class="w-10 h-10 rounded-full" src="https://unsplash.com/photos/7Zb7kUyQg1E/download?force=true&w=640" alt="David">
                              <span class="ml-3 font-medium">David</span>
                          </div>
                          <div>
                              <button class="text-gray-500 hover:text-gray-700">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                                  </svg>
                              </button>
                          </div>
                      </li>
                      <li class="p-3 flex justify-between items-center user-card">
                          <div class="flex items-center">
                              <img class="w-10 h-10 rounded-full" src="https://unsplash.com/photos/F_-0BxGuVvo/download?force=true&w=640" alt="Nancy">
                              <span class="ml-3 font-medium">Nancy</span>
                          </div>
                          <div>
                              <button class="text-gray-500 hover:text-gray-700">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                                  </svg>
                              </button>
                          </div>
                      </li>
                      <li class="p-3 flex justify-between items-center user-card">
                          <div class="flex items-center">
                              <img class="w-10 h-10 rounded-full" src="https://unsplash.com/photos/3TLl_97HNJo/download?force=true&w=640" alt="Stella">
                              <span class="ml-3 font-medium">Stella</span>
                          </div>
                          <div>
                              <button class="text-gray-500 hover:text-gray-700">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                                  </svg>
                              </button>
                          </div>
                      </li>
                      <li class="p-3 flex justify-between items-center user-card">
                          <div class="flex items-center">
                              <img class="w-10 h-10 rounded-full" src="https://unsplash.com/photos/1AhGNGKuhR0/download?force=true&w=640" alt="Mary">
                              <span class="ml-3 font-medium">Mary</span>
                          </div>
                          <div>
                              <button class="text-gray-500 hover:text-gray-700">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                                  </svg>
                              </button>
                          </div>
                      </li> -->
                      
                  </ul>
              </div>
          <!-- </div> -->
      <!-- </div> -->



      </div>
    </div>
    <div class="flex flex-col flex-1">
      <header class="flex h-14 lg:h-[60px] items-center gap-4 border-b bg-muted/40 px-6 bg-blue-400">
        <a routerLink="#" class="lg:hidden" prefetch={false}>
          <!-- <MessageSquareIcon class="h-6 w-6" /> -->
          <svg
          class="text-white"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
        </svg>
  
  
          <span class="sr-only">Chat</span>
        </a>
        <div class="flex items-center gap-4">
          <!-- <Avatar class="w-8 h-8 border">
            <AvatarImage src="/placeholder-user.jpg" alt="Image" />
            <AvatarFallback>JD</AvatarFallback>
          </Avatar> -->

          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-white">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
          </svg>
          <div class="flex-1">
            <div class="font-medium ">{{'Usuario ' + idUser}}</div>
            <div class="text-muted-foreground text-sm  ">Online</div>
          </div>
        </div>
        <div class="ml-auto flex items-center gap-2">
          <Button variant="ghost" size="icon" class="h-8 w-8">
            <!-- <PhoneIcon class="h-4 w-4" /> -->
            <svg
            class="text-white"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
          </svg>
  
  
            <span class="sr-only">Call</span>
          </Button>
          <Button variant="ghost" size="icon" class="h-8 w-8">
            <!-- <VideoIcon class="h-4 w-4" /> -->
            <svg
            class="text-white"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5" />
            <rect x="2" y="6" width="14" height="12" rx="2" />
          </svg>
  
  
            <span class="sr-only">Video</span>
          </Button>
          <Button variant="ghost" size="icon" class="h-8 w-8">
            
            <span class="sr-only">More</span>
          </Button>
        </div>
      </header>
      <main class="flex-1 overflow-auto p-4 md:p-6" >
        <div class="grid gap-4 h-1">

                    
          
          
          @if(chatService.messages.length != 0){
            @for(message of chatService.messages; track message.idMensaje){
  
              <div class="flex items-start gap-4 "  [ngClass]="(message.emisorId == idUser) ? 'justify-end' : ''">
                <app-message [id]="message.emisorId" [name]="(message.emisorId == idUser) ? 'Tú' : 'Usuario ' + message.emisorId" [message]="message.mensaje" [time]="message.fechaHora.toString()"/>
              </div>
            }

          } @else {
            <div class="flex items-center justify-center">
              No hay chats por mostrar...
            </div>
          }

          
        </div>
      </main>
      <div class="max-w-2xl w-full sticky bottom-0 mx-auto py-2 flex flex-col gap-1.5 px-4 bg-background"><form (ngSubmit)="sendMessageSocket()" #messageForm="ngForm">
        <div class="relative">
          <textarea
            placeholder="Escribe tu mensaje..."
            name="message"
            id="message"
            rows="1"
            [(ngModel)]="message"
            class="min-h-[48px] rounded-2xl resize-none p-4 border border-neutral-400 shadow-sm pr-16 w-[85%]"
            (keydown.enter)="onEnterPress($event)"
          ></textarea>
          <button type="submit" size="icon" class="absolute w-8 h-8 top-3 right-3">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
              strokeLinecap="round"
              strokeLinejoin="round"
            >
              <path d="m22 2-7 20-4-9-9-4Z" />
              <path d="M22 2 11 13" />
            </svg>
            <span class="sr-only">Send</span>
          </button>
        </div>
      </form>
      </div>
    </div>
  </div>
  